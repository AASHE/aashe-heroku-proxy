global
    maxconn 256

defaults
    mode http
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms

frontend http-in
    bind 0.0.0.0:$PORT

    option forwardfor

    # Redirect all requests to /campus-sustainability-month* to the `campus-sustainability-month` app.
    use_backend campus-sustainability-month if { path_beg /campus-sustainability-month }

    # Redirect all requests to /sustainable-campus-partners-directory* to the `cspd-prod` app.
    use_backend cspd-prod if { path_beg /sustainable-campus-partners-directory }

backend campus-sustainability-month
    http-request set-header X-Forwarded-Host aashe.org
    http-request set-header X-Forwarded-Port %[dst_port]

    reqirep ^Host: Host:\ campus-sustainabality-month.herokuapp.com

    server campus-sustainability-month campus-sustainability-month.herokuapp.com:80

backend cspd-prod
    http-request set-header X-Forwarded-Host aashe.org
    http-request set-header X-Forwarded-Port %[dst_port]

    reqirep ^Host: Host:\ cspd-prod.herokuapp.com

    server cspd-prod cspd-prod.herokuapp.com:80
